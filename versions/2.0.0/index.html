<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./ram-state.js"></script>
</head>

<body>
    <h1>RamState Version 1</h1>

    <button id="btn">Btn1</button>
    <button id="btn2">Btn2</button>

    <input type="text" id="input">

    <p>Task: <span id="task"></span></p>

    <ul id="taskList"></ul>
</body>

<script>

    const { useState, useEffect } = RamState();

    const count = useState(0);
    const count2 = useState(0);
    const task = useState('');
    const todo = useState([]);

    document.getElementById('btn').addEventListener('click', () => count.set(v => v + 1));
    document.getElementById('btn2').addEventListener('click', () => count2.set(v => v + 1));
    document.getElementById('input').addEventListener('keypress', (e) => {

        if (e.target.value.trim() !== '') {

            task.set(e.target.value);

            if (e.key === 'Enter') {
                task.set('');
                todo.set(list => [...list, e.target.value]);
                e.target.value = '';
            }
        }

    });

    todo.watchEffect(({ data }) => {
        document.getElementById('taskList').innerHTML = data.map((item, i) => {
            return `<li class="list-group-item d-flex justify-content-between gap-2 align-items-center">
                <button class="btn btn-danger" onclick="removeTask(${i})">x</button>
                <span>${item}</span>
            </li>`;
        }).join('');
    }, true);

    const removeTask = (ind) => {
        todo.set(list => list.filter((item, i) => i !== ind));
    }

    count.watchEffect((cntxt) => {
        document.getElementById('btn').textContent = `Btn1 ${cntxt.data}`;
    }, true);

    count2.watch(cntxt => {
        document.getElementById('btn2').textContent = `Btn2 ${cntxt.data}`;
    }, true);

    task.watchEffect(({ data }) => {
        document.getElementById('task').textContent = data;
    }, true);

    useEffect(() => {
        console.log("Runs only once at mount");
    }, []);

    useEffect(() => {
        console.log("Runs on every set()");
    });

    useEffect(() => {
        console.log("Runs when count,count2, task changes:");
        return () => console.warn("Runs on unmount");
    }, [count, count2, task]);

    useEffect(() => {
        console.log("Runs when count changes:", count.get());
    }, [count]);


</script>

</html>