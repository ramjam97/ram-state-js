<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ramjam97/ram-state-js@master/versions/2.0.0/ram-state.min.js"></script>

    <style>
        .cursor-pointer {
            cursor: pointer;
        }

        .completed {
            text-decoration: line-through;
        }
    </style>
</head>

<body>
    <div class="container pt-3">

        <h1 class="text-center text-primary">RamState Demo</h1>

        <br>
        <div class="d-flex flex-column justify-content-center align-items-center gap-2">

            <h5>TODO</h5>

            <div class="col-md-6">
                <input type="text" class="form-control border border-secondary" placeholder="Enter task" id="inputTask">
            </div>

            <div class="col-md-6 d-flex flex-row justify-content-between align-items-center">
                <b>Count: <span id="todoCount"></span></b>
                <div class="col-md-3">
                    <select class="form-select form-select-sm" id="filterSelect">
                        <option value="all">All</option>
                        <option value="completed">Completed</option>
                        <option value="ongoing">Ongoing</option>
                    </select>
                </div>
            </div>

            <div class="col-md-6">
                <ul class="list-group" id="todoList"></ul>
            </div>

        </div>

    </div>
</body>
<script>
    const { useState, useEffect } = RamState();

    const todo = useState([]);
    const filterBy = useState('all');

    document.getElementById('filterSelect').addEventListener('change', function (e) {
        filterBy.set(e.target.value);
    });

    document.getElementById('inputTask').addEventListener('keypress', function (e) {
        const val = e.target.value;
        if (e.key === 'Enter' && val?.trim() !== '') {

            const lastId = ([...todo.get()].pop())?.id || 0;

            todo.set(list => [...list, {
                id: lastId + 1,
                task: val,
                completed: false
            }]);
            e.target.value = '';
        }
    });

    function removeTask(id) {
        todo.set(list => list.filter(item => item.id !== id));
    }

    function toggleCompleted(id) {
        todo.set(list => list.map(item => {
            if (item.id === id) {
                return {
                    ...item,
                    ...{ completed: !item.completed }
                };
            }
            return item;
        }));
    }


    useEffect(() => {

        const totalCompleted = todo.get().filter(item => item.completed).length;

        document.getElementById('todoCount').innerHTML = `${totalCompleted}/${todo.get().length}`;

        let filteredList = [...todo.get()].filter(item => {
            if (filterBy.get() === 'completed') return item.completed;
            if (filterBy.get() === 'ongoing') return !item.completed;
            return true;
        });

        if (filteredList.length > 0) {
            document.getElementById('todoList').innerHTML = filteredList
                .map(item => {
                    return `<li class="list-group-item d-flex justify-content-between">
                        <span class="cursor-pointer ${item.completed ? 'completed' : ''}" onclick="toggleCompleted(${item.id})">
                            ${item.id}.  ${item.task}
                        </span> 
                        <button class="btn-close" onclick="removeTask(${item.id})"></button>
                    </li>`;
                }).join('');
        } else {
            document.getElementById('todoList').innerHTML = `<li class="list-group-item">No task yet</li>`
        }

    }, [todo, filterBy]);


</script>

</html>